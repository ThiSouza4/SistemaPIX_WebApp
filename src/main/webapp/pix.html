<!DOCTYPE html>
<html lang="pt-BR">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Transferência PIX</title>
    <link rel="stylesheet" href="css/style.css">
</head>
<body>
    <div class="main-container">
        <a href="dashboard.html" class="form-link" style="margin-bottom: 20px;">&larr; Voltar ao Painel</a>
        <div class="card">
            <h2>Transferência PIX</h2>
            <form id="pix-transfer-form">
                <div class="input-group">
                    <label for="tipo_chave_pix">Tipo da Chave de Destino</label>
                    <select id="tipo_chave_pix" name="tipo_chave_pix" required><option value="CPF">CPF</option><option value="EMAIL">E-mail</option><option value="CELULAR">Celular</option><option value="ALEATORIA">Chave Aleatória</option></select>
                </div>
                <div class="input-group">
                    <label for="chave_pix">Chave PIX</label>
                    <input type="text" id="chave_pix" name="chave_pix" placeholder="Digite a chave de destino" required>
                </div>
                <div class="input-group">
                    <label for="valor_pix">Valor (R$)</label>
                    <input type="text" id="valor_pix" placeholder="0,00" required>
                </div>
                <button type="submit" class="btn-primary">Realizar Transferência</button>
            </form>
            <div id="pix-message" class="message" style="display: none;"></div>
        </div>
    </div>
    
    <script>
        function applyMask(value, maskFunction, maxLength) { const maskedValue = maskFunction(value); return maskedValue.length > maxLength ? maskedValue.substring(0, maxLength) : maskedValue; }
        function cpfMask(v) { return v.replace(/\D/g, '').replace(/(\d{3})(\d)/, '$1.$2').replace(/(\d{3})(\d)/, '$1.$2').replace(/(\d{3})(\d{1,2})$/, '$1-$2'); }
        function phoneMask(v) { return v.replace(/\D/g, '').replace(/^(\d{2})(\d)/g, '($1) $2').replace(/(\d{5})(\d)/, '$1-$2'); }
        function currencyMask(v) {
            if (!v || v.replace(/\D/g, '') === '') {
                return ""; // Retorna vazio para o placeholder funcionar
            }
            let value = v.replace(/\D/g, '');
            // Limita o valor para não ser "infinito" - Ex: R$ 9.999.999,99
            if (value.length > 9) {
                value = value.substring(0, 9);
            }
            value = (parseInt(value, 10) / 100).toFixed(2) + '';
            value = value.replace('.', ',');
            value = value.replace(/(\d)(?=(\d{3})+(?!\d))/g, '$1.');
            return `R$ ${value}`;
        }

        document.addEventListener('DOMContentLoaded', () => {
            const tipoChaveSelect = document.getElementById('tipo_chave_pix');
            const chaveInput = document.getElementById('chave_pix');
            const valorInput = document.getElementById('valor_pix');

            function handleKeyInputMask() {
                chaveInput.value = '';
                chaveInput.maxLength = 50;
                if (tipoChaveSelect.value === 'CPF') chaveInput.maxLength = 14;
                if (tipoChaveSelect.value === 'CELULAR') chaveInput.maxLength = 15;
            }
            tipoChaveSelect.addEventListener('change', handleKeyInputMask);
            chaveInput.addEventListener('input', () => {
                const tipo = tipoChaveSelect.value;
                if (tipo === 'CPF') chaveInput.value = applyMask(chaveInput.value, cpfMask, 14);
                if (tipo === 'CELULAR') chaveInput.value = applyMask(chaveInput.value, phoneMask, 15);
            });
            valorInput.addEventListener('input', (e) => {
                e.target.value = currencyMask(e.target.value);
            });
            handleKeyInputMask();
        });
    </script>
    <script src="js/global.js"></script>
</body>
</html>